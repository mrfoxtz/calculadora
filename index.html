
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simulador de Obra</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f7f7f7; }
    input, select { padding: 5px; margin: 3px; }
    table { border-collapse: collapse; width: 100%; margin-top: 15px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background-color: #eee; }
    .resumo { margin-top: 20px; }
    .highlight { font-weight: bold; padding: 10px; margin-top: 10px; }
    .red { background-color: #ffcccc; }
    .yellow { background-color: #fff2cc; }
    .green { background-color: #ccffcc; }
  </style>
</head>
<body>
  <h1>Simulador de Obra</h1>

  <label>Custo por m²: <input id="custo_m2" type="number" step="any" /></label>
  <label>Lucro Esperado (%): <input id="lucro" type="number" step="any" /></label>
  <label>% Imposto: <input id="imposto" type="number" step="any" /></label>
  <label>% Comissão: <input id="comissao" type="number" step="any" /></label>
  <label>Valor da Permuta/Terreno ou Comissão: <input id="valor_permuta" type="number" step="any" /></label>

  <table id="tabela">
    <thead>
      <tr>
        <th>Proprietário</th>
        <th>Metragem</th>
        <th>Quantidade</th>
        <th>Total m²</th>
      </tr>
    </thead>
    <tbody>
      ${Array(5).fill(0).map((_, i) => `
        <tr>
          <td><select id="origem_${i}"><option>Permuta</option><option>Construtora</option></select></td>
          <td><input id="metragem_${i}" type="number" step="any" /></td>
          <td><input id="quantidade_${i}" type="number" step="any" /></td>
          <td><span id="total_${i}">0</span></td>
        </tr>
      `).join('')}
    </tbody>
  </table>

  <button onclick="calcular()">Calcular</button>

  <div class="resumo">
    <div id="valor_m2">Valor por m²: R$ 0,00</div>
    <div id="custo_total">Custo Geral da Obra: R$ 0,00</div>
    <div id="vgv">VGV Geral da Obra: R$ 0,00</div>
    <div id="lucro_liquido" class="highlight">Lucro Líquido: R$ 0,00</div>
    <div id="roi" class="highlight">ROI: 0,00%</div>
  </div>

  <h3>Sugestão de VGV por unidade:</h3>
  <pre id="sugestoes"></pre>

  <script>
    function formatar(valor) {
      return valor.toLocaleString("pt-BR", { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    function calcular() {
      let custoM2 = parseFloat(document.getElementById("custo_m2").value) || 0;
      let lucro = parseFloat(document.getElementById("lucro").value) / 100 || 0;
      let imposto = parseFloat(document.getElementById("imposto").value) / 100 || 0;
      let comissao = parseFloat(document.getElementById("comissao").value) / 100 || 0;
      let valorPermutaExtra = parseFloat(document.getElementById("valor_permuta").value) || 0;

      let totalGeralM2 = 0, totalPermutaM2 = 0, unidadesConstrutora = [];
      for (let i = 0; i < 5; i++) {
        let origem = document.getElementById(`origem_${i}`).value;
        let metragem = parseFloat(document.getElementById(`metragem_${i}`).value) || 0;
        let quantidade = parseFloat(document.getElementById(`quantidade_${i}`).value) || 0;
        let total = metragem * quantidade;
        document.getElementById(`total_${i}`).innerText = formatar(total);

        if (origem === "Permuta") totalPermutaM2 += total;
        else unidadesConstrutora.push([metragem, quantidade]);

        totalGeralM2 += total;
      }

      let custoConstrucao = (totalGeralM2 - totalPermutaM2) * custoM2;
      let custoPermuta = (totalPermutaM2 * custoM2) + valorPermutaExtra;
      let custoTotal = custoConstrucao + custoPermuta;
      let vgv = (custoTotal * (1 + lucro)) / (1 - (imposto + comissao));
      let lucroLiquido = vgv - custoTotal;
      let roi = custoTotal > 0 ? lucroLiquido / custoTotal : 0;
      let valorM2 = vgv / ((totalGeralM2 - totalPermutaM2) || 1);

      document.getElementById("valor_m2").innerText = "Valor por m²: R$ " + formatar(valorM2);
      document.getElementById("custo_total").innerText = "Custo Geral da Obra: R$ " + formatar(custoTotal);
      document.getElementById("vgv").innerText = "VGV Geral da Obra: R$ " + formatar(vgv);

      let lucroElem = document.getElementById("lucro_liquido");
      let roiElem = document.getElementById("roi");

      lucroElem.innerText = "Lucro Líquido: R$ " + formatar(lucroLiquido);
      roiElem.innerText = "ROI: " + (roi * 100).toFixed(2).replace(".", ",") + "%";

      lucroElem.className = roiElem.className = "highlight";
      if (roi < 0.15) lucroElem.classList.add("red"), roiElem.classList.add("red");
      else if (roi <= 0.30) lucroElem.classList.add("yellow"), roiElem.classList.add("yellow");
      else lucroElem.classList.add("green"), roiElem.classList.add("green");

      let sugestoes = "Proprietário       Metragem     Qtd     Sugestão R$
";
      for (let i = 0; i < 5; i++) {
        let origem = document.getElementById(`origem_${i}`).value;
        let metragem = parseFloat(document.getElementById(`metragem_${i}`).value) || 0;
        let quantidade = parseFloat(document.getElementById(`quantidade_${i}`).value) || 0;
        let sugestao = valorM2 * metragem;
        sugestoes += `${origem.padEnd(18)}${formatar(metragem).padEnd(13)}${quantidade.toString().padEnd(8)}${formatar(sugestao)}
`;
      }
      document.getElementById("sugestoes").innerText = sugestoes;
    }
  </script>
</body>
</html>
